<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TODOリスト</title>
    <style>
        .done { text-decoration: line-through; color: gray; }
        body { font-family: Arial, sans-serif; margin: 20px; }
        .task-item { margin-bottom: 10px; display: flex; align-items: center; }
        .task-item form { display: inline-block; margin-left: 10px; }
        input[type="text"] { padding: 8px; width: 300px; }
        button { padding: 8px 15px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>シンプルな TODO リスト</h1>

    <form th:action="@{/add}" method="post" th:object="${task}">
		<span th:if="${#fields.hasErrors('content')}" 
		          th:errors="*{content}" style="color: red;">
		          エラーメッセージが表示されます
		</span>
		
        <input type="text" name="content" placeholder="新しいタスクを入力" required>
		
		<input type="date" th:field="*{deadline}" required> 
		    
		    <select th:field="*{priority}">
		        <option value="1">優先度：高</option>
		        <option value="2" selected>優先度：中</option>
		        <option value="3">優先度：低</option>
		    </select>
			
        <button type="submit">追加</button>
    </form>

    <hr>

    <h2>タスク一覧</h2>
    <div th:each="task : ${tasks}" class="task-item">
        <span th:classappend="${task.done ? 'done' : ''}" th:text="${task.content}">タスク内容（例）</span>
        
		<small th:text="'（期限：' + ${task.deadline} + '）'"></small>
		    <small>
		        <span th:switch="${task.priority}">
		            <span th:case="1" style="color: red;">【高】</span>
		            <span th:case="2" style="color: orange;">【中】</span>
		            <span th:case="3" style="color: green;">【低】</span>
		        </span>
		    </small>
			
        <form th:action="@{/complete/{id}(id=${task.id})}" method="post">
            <button th:text="${task.done ? '未完了に戻す' : '完了！'}" type="submit"></button>
        </form>

        <form th:action="@{/delete/{id}(id=${task.id})}" method="post">
            <button type="submit">削除</button>
        </form>
    </div>

    <div th:if="${#lists.isEmpty(tasks)}">
        <p>登録されているタスクはありません。</p>
    </div>

</body>
</html>